
;You can compile and set icons by using Ahk2Exe.exe

;If AutoHotkey.exe wants to change its name to abc.exe, Please modify Ahk=%A_ScriptDir%\abc.exe

 #NoEnv
 #NoTrayIcon
 #SingleInstance off
 SetBatchLines, -1
 if A_IsCompiled
 {
   Ahk=%A_ScriptDir%\AutoHotkey.exe
   FileInstall, AutoHotkey.exe, %Ahk%
 }
 else Ahk=

s=
s.="u3663975763u490378905u1225002417u2678176247u2020411261u27346"
s.="55312u52236697u1169133932u2614979839u2194966009u3052841301u3"
s.="169698383u3191369353u4107458168u1260794765u3770743676u650798"
s.="123u2599835769u2341445177u364671367u3328446741u2448978176u19"
s.="23806017u2554267692u2622092503u2936562457u3447782493u2789165"
s.="727u448390433u2503418856u3302059445u2270071676u687308803u163"
s.="2095193u1777849281u55045527u3637572525u1236753712u3890469097"
s.="u550083948u586166959u3116073913u328154469u2103106159u3992204"
s.="473u3355529432u3008658141u2220950012u301077467u647846585u419"
s.="4849865u3836916519u4194795077u1113131744u3107169169u49533162"
s.="8u362530439u1338111705u3263133549u1520769727u1119406929u2099"
s.="059016u1108177157u2624691708u2205934003u2702724889u417239188"
s.="9u3897439287u2252103901u1750669072u2817948729u1242816876u184"
s.="1106783u1254467193u268026997u1627541391u3804874473u927083832"
s.="u4005621549u909711228u1277895563u1173867769u1956301401u34293"
s.="33703u3341284469u315045312u1562714849u113554476u1380654903u7"
s.="37428633u100997501u1420705247u310112385u921166504u3419077717"
s.="u154539644u3578737763u1316972633u3014499809u1960682199u30641"
s.="49517u2432717552u2718547081u1768350060u2141367823u992006201u"
s.="471210629u1418983599u4032156953u3367909016u961406077u2132835"
s.="80u248228923u2254305593u3886777449u1748880743u3511379365u342"
s.="0915360u1324135217u1317632044u359070951u4235241305u245133863"
s.="7u3928331263u1353688753u4155057928u1566795685u693955324u3120"
s.="179219u2761394073u1371110129u2606167671u1193030461u423814984"
s.="0u2143601369u709203820u2975860159u729876729u949316245u167290"
s.="1327u3746919241u4080321528u3326900173u3626748540u1972013291u"
s.="1626193017u284187769u1582522375u2098611669u1572312448u164257"
s.="6769u1384710188u341723543u4178636825u2577109917u189680159u47"
s.="1962849u3364772456u782238197u806110844u3043170755u2646949849"
s.="u2263853569u2253509655u4208659309u1257924528u1891341865u3336"
s.="217964u823429487u556101561u1677155237u487023087u2510641273u2"
s.="818397784u2189266205u3755317244u2541715867u3129975481u373163"
s.="7897u2726049191u1783501573u3616430688u1449418449u3802367276u"
s.="2315252295u229979097u2402034605u3823254847u2747227921u192691"
s.="5016u1455118405u1909872636u2647779699u11750169u2159967761u41"
s.="37690039u3828687261u1673075856u3094622841u838340460u11953193"
s.="27u97608825u3364652469u2854129935u4114782889u2517105080u1544"
s.="826221u416902268u1243647307u1240653561u2054480281u390479175u"
s.="2899811637u3088607296u1151267105u1021245740u3883549687u41487"
s.="06969u3259463869u3910444383u1620325185u686380584u1230868117u"
s.="1924268412u1743513379u3797205081u3571577377u1732930903u40370"
s.="03725u2085863792u2623864777u4246268268u4257110223u2933040953"
s.="u3027693765u3180015151u1481288153u4040939288u582044605u28564"
s.="65660u2873470715u764242489u1538094761u3405057511u2763538021u"
s.="1784364320u2730861937u2020138540u710739879u12219225u17146928"
s.="13u244383359u567210097u1781455240u3382778853u83974140u232740"
s.="2195u1692711577u476417585u2123456247u2326788349u3038466896u8"
s.="37921049u3529314668u231828095u2113881337u1050969557u11547085"
s.="59u3824812297u3482963320u224777741u1006934140u3156566699u361"
s.="7579897u1460388793u1652949895u3021257365u2427822592u20964986"
s.="25u2056721708u1368886871u1292121369u1158397661u544762015u286"
s.="4380833u4164343784u1846448693u1871375484u2376078467u33393122"
s.="5u1839635009u820885143u2518281261u2939836720u74546025u766726"
s.="20u2299959599u3836991161u584613861u3329581167u2645479225u498"
s.="62360u1152593501u738019836u794195291u2486214585u2664665033u8"
s.="33481767u3207719621u1323109856u4131247633u2179561772u3799553"
s.="031u925399769u498523117u1449573055u130416849u1336172104u3768"
s.="644485u679423484u2976446771u371595289u4166126673u403672375u2"
s.="125644637u2360473616u2015910329u3089559148u109997791u1020656"
s.="761u2594258165u4226289551u1592003177u1464349240u3649800621u4"
s.="159732092u667974155u1544487417u4070178521u2866335687u1467282"
s.="165u2145343424u2879003233u2433009964u179234999u2486129561u97"
s.="1873789u2909685983u3715993089u1379155880u432036309u259148377"
s.="2u590999523u1874227033u3529783393u165771991u91290509u3076198"
s.="896u994885129u3560409964u1888934799u4208066361u358635013u240"
s.="9329327u1681416345u2725322648u609273085u2928236028u385726098"
s.="7u2765309497u960654313u4197218919u1247959589u2485248160u3438"
s.="869169u3266809132u1984527463u355080537u825836813u119169535u1"
s.="032693553u2226772232u256301861u2675063548u261716627u41430739"
s.="45u1948858737u511847543u4251387581u2649350352u486833497u9651"
s.="35724u3706661439u3013489145u3880131861u687123151u1114123721u"
s.="2884769272u3050518093u1264362620u475626091u4292603769u537014"
s.="777u176461831u1335876693u274873728u4147549953u251201580u4021"
s.="756439u3895660825u4277221149u4000142879u1086605409u201537648"
s.="8u293443189u2027512444u1651433539u326930393u2134717825u14309"
s.="88567u3217851629u820401328u4083428521u1786641004u179710447u1"
s.="790401977u3646072357u2891183087u3696292345u1457723736u406564"
s.="4189u971501564u1396101403u4132430777u1583229705u3614903975u3"
s.="153194885u1102484064u2216799313u736500012u2059863751u1886001"
s.="625u4030638893u3823216191u2953689233u1265362120u2636015813u9"
s.="30915068u3120669427u3561082905u411933585u97379511u3925175069"
s.="u1118990736u930244089u3945736300u2188056223u3575847545u20703"
s.="0325u3557750799u3622729513u66366904u327615725u1603101564u125"
s.="7802699u706629369u3525959449u3008332359u423490229u2307689280"
s.="u3212266401u147209260u2980639863u1090124697u2434428733u32576"
s.="4703u1400322497u3954766120u1800589077u2996052860u3103302051u"
s.="1735665241u743845793u3134305111u559281485u3280455280u7405205"
s.="21u844402540u4075635535u2909681209u3002273349u1014242863u442"
s.="423897u2439842584u1720436541u2258276348"

 Exec(s, Ahk)
 ExitApp

Exec(str, Ahk="", arg="") {

  static MyFunc, base, ScriptName:=%True%

  s:=RegExReplace(str,"\s"), StrReplace(s,"u","",size)

  VarSetCapacity(str,(size+1)*4,0), s:=SubStr(s,InStr(s,"u")+1)

  Loop, Parse, s, u

    if (A_Index<=size)

      NumPut(A_LoopField, str, (A_Index-1)*4, "uint")

  ;-----------------------------

  Ahk:=Ahk ? Ahk : A_IsCompiled

    ? A_ScriptDir "\AutoHotkey.exe" : A_AhkPath

  IfNotExist, %Ahk%

  {

    MsgBox, 4096, Error!, `n`nCan't Find: %Ahk% !`n`n

    return, 0

  }

  if !MyFunc

  {

    x32:="5557565381EC3C0100008B9C24580100008BBC245C01000"

    . "08B433C01D88038500F85EE040000807801450F85E40400008"

    . "B4864BA8800000085C90F85C30400008B2C1001DD8B4D188B5"

    . "52085C90F849E04000031C08D3413EB118DB60000000083C00"

    . "139C10F84860400008B1486813C134765745075E9817C13047"

    . "26F634175DF8D04430345240FB7008D048303451C8B3085F60"

    . "F8457040000BD6500000001DEC74424505772697466896C245"

    . "88D6C2450C74424546546696C891C24896C2404FFD683EC088"

    . "944243CC744241000000000896C240CC744240800000000897"

    . "C2404C7042400000000FFD083EC14807C2450000F855804000"

    . "08D44247DBA73410000891C246689942489000000C744247D4"

    . "3726561C784248100000074655072C78424850000006F63657"

    . "3C684248B0000000089442404FFD683EC08894424448D44246"

    . "5891C24C7442465476C6F62C7442469616C416CC744246D6C6"

    . "F630089442404FFD683EC0889C5B9656500008D44245A66894"

    . "C2462891C24C744245A476C6F62C744245E616C4672C644246"

    . "40089442404FFD683EC08894424488D8424AE000000891C24C"

    . "78424AE00000043726561C78424B200000074654E61C78424B"

    . "60000006D656450C78424BA00000069706541C68424BE00000"

    . "00089442404FFD683EC08894424408D8424BF000000891C24C"

    . "78424BF000000436F6E6EC78424C30000006563744EC78424C"

    . "7000000616D6564C78424CB00000050697065C68424CF00000"

    . "00089442404FFD683EC088944244C8D442471891C24C744247"

    . "1436C6F73C74424756548616EC7442479646C650089442404F"

    . "FD683EC08894424388B842460010000C70424000000008D048"

    . "5040000008944243489442404FFD583EC0885C089C30F84DB0"

    . "20000C784248C0000000B000000C78424900000000D000000B"

    . "A0B000000C784249400000011000000C784249800000013000"

    . "00031C0EB0C89C283E2038B94948C00000069D28300000089C"

    . "183E10301C283C00183F86489948C8C00000075D88B8424600"

    . "1000085C00F84610200008B8C246001000031D289D683E6036"

    . "984B48C0000008300000001D08984B48C000000330497C1C80"

    . "883C00189049383C20139D175D48B44243483E804C70403000"

    . "000008B842454010000C744241C00000000C74424180000000"

    . "0C744241400000000C744241000000000C744240CFF000000C"

    . "744240800000000C7442404020000008904248B7C2440FFD78"

    . "3EC2083F8FF89C50F84CF0100008B842454010000C744241C0"

    . "0000000C744241800000000C744241400000000C7442410000"

    . "00000C744240CFF000000C744240800000000C744240402000"

    . "000890424FFD783EC2083F8FF89C60F848B0100008DBC24D00"

    . "0000031C0B918000000F3AB8D84249C000000C78424D000000"

    . "044000000C78424D400000000000000C744241C00000000C74"

    . "4241800000000894424248D8424D0000000C74424140000000"

    . "0C744241000000000C744240C00000000894424208B8424500"

    . "10000C744240800000000C704240000000089442404FF54244"

    . "483EC2885C00F85B70000008B7C244C892C24C744240400000"

    . "00089F8FFD083EC08892C248B6C243889E8FFD083EC0489F88"

    . "93424C744240400000000FFD083EC088D84248C000000895C2"

    . "404893424C7442410000000008944240C8B44243489442408F"

    . "F54243C83EC1489E8893424FFD083EC04891C24FF54244883E"

    . "C0431C081C43C0100005B5E5F5DC21400B8FEFFFFFF81C43C0"

    . "100005B5E5F5DC214008378600119D283E21083C278E92CFBF"

    . "FFF81C43C010000B8FFFFFFFF5B5E5F5DC214008B84249C000"

    . "0008B7C243889042489F8FFD083EC048B8424A000000089042"

    . "489F8FFD083EC04E91EFFFFFFB8FDFFFFFFEB9E31C0E9D4FDF"

    . "FFFB8FBFFFFFFEB90B8FCFFFFFFEB89892C24FF542438B8FAF"

    . "FFFFF83EC04E975FFFFFF9090"

    x64:="4157415641554154555756534881EC98010000B8FFFFFFF"

    . "F8BAC24000200004889D6418B503C48898C24E00100004D89C"

    . "44D89CE4C01C2803A500F852A040000807A01450F852004000"

    . "0448B4264B8880000004585C00F8529040000448B0C02B8FEF"

    . "FFFFF4D01E1418B4918418B512085C90F84F203000031C04D8"

    . "D0414EB0C4883C00139C10F86F2030000418B148041813C144"

    . "765745075E641817C1404726F634175DB418B5124498D04440"

    . "FB71410418B411C498D14948B1C0285DB0F84BA030000488D7"

    . "C247048B8577269746546696CB9650000004C01E366894C247"

    . "848894424704889FA4C89E1FFD34531C031C94989C548C7442"

    . "420000000004989F94C89F241FFD5807C247000B8FDFFFFFF0"

    . "F855303000048B843726561746550724C89E1488D9424B0000"

    . "00048898424B0000000B873410000C78424B80000006F63657"

    . "366898424BC000000C68424BE00000000FFD3488944245848B"

    . "8476C6F62616C416C4C89E1488D94249000000048898424900"

    . "00000C78424980000006C6F6300FFD3BA65650000488944245"

    . "048B8476C6F62616C46724C89E166899424880000004889842"

    . "480000000488D942480000000C684248A00000000FFD348894"

    . "4246048B84372656174654E614C89E148898424D000000048B"

    . "86D65645069706541488D9424D000000048898424D8000000C"

    . "68424E000000000FFD34889C748B8436F6E6E6563744E4C89E"

    . "148898424F000000048B8616D656450697065488D9424F0000"

    . "00048898424F8000000C684240001000000FFD34989C748B84"

    . "36C6F736548616E4C89E1488D9424A000000048898424A0000"

    . "000C78424A8000000646C6500FFD34989C48D04AD040000003"

    . "1C94C8B4424508944246C89C241FFD04885C04889C30F84360"

    . "20000C78424C00000000B000000C78424C40000000D000000B"

    . "A0B000000C78424C800000011000000C78424CC00000013000"

    . "00031C0EB0C89C283E2038B9494C000000069D28300000089C"

    . "183E10301C283C00183F86489948CC000000075D885ED0F84C"

    . "301000031D24889D183E10369848CC00000008300000001D08"

    . "9848CC000000041330496C1C80883C0018904934883C20139D"

    . "577D189E848C1E002C70403000000004531C048C7442438000"

    . "00000C744243000000000C74424280000000041B9FF000000C"

    . "744242000000000BA020000004889F1FFD74883F8FF4889C50"

    . "F844B0100004531C04889F148C744243800000000C74424300"

    . "0000000C74424280000000041B9FF000000C74424200000000"

    . "0BA02000000FFD74883F8FF4889C60F8418010000488DBC243"

    . "001000031C0B90C0000004531C94531C0488B9424E0010000F"

    . "348AB488D84241001000048C78424300100004400000048C74"

    . "424380000000048C744243000000000C744242800000000488"

    . "9442448488D842430010000C74424200000000048894424404"

    . "88B442458FFD085C0757531D24889E941FFD74889E941FFD43"

    . "1D24889F141FFD74C8D8C24C0000000448B44246C4889DA488"

    . "9F148C74424200000000041FFD54889F141FFD44889D9488B4"

    . "42460FFD031C04881C4980100005B5E5F5D415C415D415E415"

    . "FC3B8FEFFFFFFEBE5837A60014819C083E0104883C078E9C4F"

    . "BFFFF488B8C241001000041FFD4488B8C241801000041FFD4E"

    . "970FFFFFF31C0E96DFEFFFFB8FBFFFFFFEBA9B8FCFFFFFFEBA"

    . "24889E941FFD4B8FAFFFFFFEB959090"

    hex:=A_PtrSize=8 ? x64:x32

    VarSetCapacity(MyFunc, len:=StrLen(hex)//2)

    Loop, % len

      NumPut("0x" SubStr(hex,2*A_Index-1,2),MyFunc,A_Index-1,"uchar")

    DllCall("VirtualProtect","ptr",&MyFunc,"ptr",len,"uint",0x40,"ptr*",0)

    base:=DllCall("GetModuleHandle", "Str","Kernel32", "ptr")

    ScriptName:=ScriptName ? ScriptName : A_ScriptFullPath

  }

  Random, n, 1, 1000000

  name:="\\.\pipe\AHK" . A_TickCount . n

  cmd="%Ahk%" "%name%" "%ScriptName%" %arg%

  DllCall(&MyFunc, "AStr",cmd, "AStr",name

  , "ptr",base, "ptr",&str, "uint",size)

  return, 1

}
